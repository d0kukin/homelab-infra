# =============================================
# dnsmasq config — pve1 (DHCP + DNS for VM network)
# =============================================

# Listen only on VM bridge
interface=vmnet
bind-interfaces

# Do not read /etc/resolv.conf
no-resolv

# Upstream DNS
server=8.8.8.8
server=1.1.1.1

# ---- DHCP ----
# Lease infinite — IP lives until VM is deleted and lease manually cleaned
dhcp-range=10.10.20.100,10.10.20.200,255.255.255.0,infinite
dhcp-option=option:router,10.10.20.1
dhcp-option=option:dns-server,10.10.20.1
dhcp-option=option:domain-search,lab.internal
dhcp-option=option:mtu,1450

dhcp-leasefile=/var/lib/misc/dnsmasq.leases

# ---- Static DHCP reservations ----
# Add important VMs here when needed:
# dhcp-host=MAC,hostname,IP
# address=/hostname.lab.internal/IP

# ---- DNS ----
domain=lab.internal
local=/lab.internal/

# Cluster nodes — VM-side addresses
address=/pve1.lab.internal/10.10.20.1
address=/pve2.lab.internal/10.10.20.2
address=/pve3.lab.internal/10.10.20.3

# ---- Logging (disable after testing) ----
log-queries
log-dhcp
log-facility=/var/log/dnsmasq.log
