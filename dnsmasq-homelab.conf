# =============================================
# dnsmasq config — pve1 (DHCP + DNS for VM network)
# =============================================

# Listen only on VM bridge (no DHCP/DNS on management or Wi-Fi)
interface=vmbr1
bind-interfaces

# Do not read /etc/resolv.conf
no-resolv

# Upstream DNS
server=8.8.8.8
server=1.1.1.1

# ---- DHCP ----
dhcp-range=10.10.20.100,10.10.20.200,255.255.255.0,12h
dhcp-option=option:router,10.10.20.1
dhcp-option=option:dns-server,10.10.20.1
dhcp-option=option:domain-search,lab.internal
# VXLAN MTU — must match overlay MTU
dhcp-option=option:mtu,1450

dhcp-leasefile=/var/lib/misc/dnsmasq.leases

# ---- DNS ----
domain=lab.internal
local=/lab.internal/

# Cluster nodes — VM-side addresses (reachable from VM network)
address=/pve1.lab.internal/10.10.20.1
address=/pve2.lab.internal/10.10.20.2
address=/pve3.lab.internal/10.10.20.3

# Static DHCP reservations (add as needed)
# dhcp-host=MAC,hostname,IP
# dhcp-host=BC:24:11:AA:BB:CC,k8s-master-1,10.10.20.10

# ---- Logging (disable after testing) ----
log-queries
log-dhcp
log-facility=/var/log/dnsmasq.log
